version: '3.9'

services:
  jenkins:
    build:
      context: .
      dockerfile: Dockerfile.jenkins
    image: actividadu2lab-jenkins:latest
    container_name: actividadu2lab-jenkins
    restart: unless-stopped

    ports:
      - "8080:8080"
      - "50000:50000"

    volumes:
      - jenkins_home:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock

    user: root

    dns:
      - 8.8.8.8
      - 1.1.1.1

    extra_hosts:
      - "kubernetes.docker.internal:host-gateway"

    environment:
      JAVA_OPTS: "-Xmx1024m -Xms512m"
      JENKINS_URL: "http://localhost:8080"

    healthcheck:
      test: [ "CMD", "curl", "-sSf", "http://localhost:8080/login" ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

volumes:
  jenkins_home:
    name: actividadu2lab-jenkins-home
